<!doctype html>
<html lang="nl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>GraphRAG Explorer - IOU Concept</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Arial, sans-serif;
                background: #f5f5f5;
            }

            .header {
                background: linear-gradient(135deg, #0066cc 0%, #004c99 100%);
                color: white;
                padding: 20px;
                text-align: center;
            }

            .header h1 {
                font-size: 28px;
                margin-bottom: 5px;
            }

            .header p {
                font-size: 14px;
                opacity: 0.9;
            }

            .container {
                max-width: 1400px;
                margin: 20px auto;
                padding: 0 20px;
            }

            .info-box {
                background: white;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 20px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .info-box h2 {
                color: #0066cc;
                margin-bottom: 10px;
                font-size: 18px;
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
            }

            .stat-card {
                background: white;
                padding: 20px;
                border-radius: 8px;
                text-align: center;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .stat-value {
                font-size: 36px;
                font-weight: bold;
                color: #0066cc;
                margin-bottom: 5px;
            }

            .stat-label {
                color: #666;
                font-size: 14px;
            }

            #mynetwork {
                width: 100%;
                height: 700px;
                border: 2px solid #ddd;
                border-radius: 8px;
                background: white;
            }

            .legend {
                background: white;
                padding: 20px;
                border-radius: 8px;
                margin-top: 20px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .legend h3 {
                color: #0066cc;
                margin-bottom: 15px;
                font-size: 16px;
            }

            .legend-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .legend-color {
                width: 30px;
                height: 30px;
                border-radius: 50%;
                border: 2px solid #333;
            }

            .controls {
                margin-top: 20px;
                display: flex;
                gap: 10px;
                justify-content: center;
            }

            .btn {
                padding: 12px 24px;
                background: #0066cc;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                transition: background 0.3s;
            }

            .btn:hover {
                background: #004c99;
            }

            .btn-secondary {
                background: #7cb342;
            }

            .btn-secondary:hover {
                background: #689f38;
            }

            .loading {
                text-align: center;
                padding: 40px;
                font-size: 18px;
                color: #666;
            }

            .error {
                background: #f44336;
                color: white;
                padding: 15px;
                border-radius: 8px;
                margin: 20px 0;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>üï∏Ô∏è GraphRAG Explorer</h1>
            <p>
                Kennisgraaf Visualisatie - Automatische Context-Relatie
                Ontdekking
            </p>
        </div>

        <div class="container">
            <div class="info-box">
                <h2>üìä Netwerk Statistieken</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">16</div>
                        <div class="stat-label">Entiteiten</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">27</div>
                        <div class="stat-label">Relaties</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Communities</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Entity Types</div>
                    </div>
                </div>
            </div>

            <div id="loading" class="loading">
                <p>‚è≥ Laden van kennisgraaf...</p>
            </div>

            <div id="error-message" style="display: none" class="error"></div>

            <div id="mynetwork"></div>

            <div class="controls">
                <button class="btn" onclick="fitNetwork()">üîç Zoom Fit</button>
                <button class="btn" onclick="togglePhysics()">
                    ‚ö° Toggle Physics
                </button>
                <button
                    class="btn btn-secondary"
                    onclick="window.location.href='context_dashboard.html'"
                >
                    üè† Dashboard
                </button>
            </div>

            <div class="legend">
                <h3>üé® Legenda - Entity Types</h3>
                <div class="legend-grid">
                    <div class="legend-item">
                        <div
                            class="legend-color"
                            style="background: #0066cc"
                        ></div>
                        <span
                            ><strong>Organisaties</strong> - Provincie,
                            Gemeentes, Ministeries</span
                        >
                    </div>
                    <div class="legend-item">
                        <div
                            class="legend-color"
                            style="background: #9c27b0"
                        ></div>
                        <span
                            ><strong>Concepten</strong> - Circulaire Economie,
                            Duurzaamheid</span
                        >
                    </div>
                    <div class="legend-item">
                        <div
                            class="legend-color"
                            style="background: #ff9800"
                        ></div>
                        <span
                            ><strong>Locaties</strong> - Flevoland, Almere,
                            Lelystad</span
                        >
                    </div>
                    <div class="legend-item">
                        <div
                            class="legend-color"
                            style="background: #f44336"
                        ></div>
                        <span
                            ><strong>Wetgeving</strong> - Woo, Omgevingswet,
                            Klimaatwet</span
                        >
                    </div>
                    <div class="legend-item">
                        <div
                            class="legend-color"
                            style="background: #7cb342"
                        ></div>
                        <span
                            ><strong>Personen</strong> - Projectleiders,
                            Beleidsmedewerkers</span
                        >
                    </div>
                </div>
            </div>

            <div class="info-box" style="margin-top: 20px">
                <h2>‚ÑπÔ∏è Over GraphRAG</h2>
                <p>
                    <strong>GraphRAG</strong> (Graph Retrieval-Augmented
                    Generation) combineert kennisgrafen met AI om automatisch
                    context-relaties te ontdekken.
                </p>
                <p style="margin-top: 10px">Deze graaf toont:</p>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8">
                    <li>
                        <strong>Entiteiten</strong>: Organisaties, personen,
                        locaties, concepten en wetten ge√´xtraheerd uit
                        documenten
                    </li>
                    <li>
                        <strong>Relaties</strong>: WORKS_FOR, MANAGES,
                        LOCATED_IN, COLLABORATES_WITH, SUBJECT_TO, etc.
                    </li>
                    <li>
                        <strong>Communities</strong>: Automatische clustering
                        van gerelateerde contexten (Duurzaamheid, Vergunningen,
                        Mobiliteit)
                    </li>
                </ul>
            </div>
        </div>

        <!-- Vis.js Network Library -->
        <script
            type="text/javascript"
            src="https://unpkg.com/vis-network@9.1.9/standalone/umd/vis-network.min.js"
        ></script>

        <script>
            console.log("GraphRAG Explorer starting...");

            let network = null;
            let physicsEnabled = true;

            // Graph data
            const nodesData = [
                {
                    id: 1,
                    label: "Provincie\nFlevoland",
                    color: "#0066CC",
                    size: 30,
                    title: "Organisatie: Provincie Flevoland",
                },
                {
                    id: 2,
                    label: "Gemeente\nAlmere",
                    color: "#0066CC",
                    size: 25,
                    title: "Organisatie: Gemeente Almere",
                },
                {
                    id: 3,
                    label: "Gemeente\nLelystad",
                    color: "#0066CC",
                    size: 20,
                    title: "Organisatie: Gemeente Lelystad",
                },
                {
                    id: 4,
                    label: "Waterschap\nZuiderzeeland",
                    color: "#0066CC",
                    size: 18,
                    title: "Organisatie: Waterschap Zuiderzeeland",
                },
                {
                    id: 5,
                    label: "Min. I&W",
                    color: "#0066CC",
                    size: 22,
                    title: "Organisatie: Ministerie van Infrastructuur en Waterstaat",
                },

                {
                    id: 10,
                    label: "Circulaire\nEconomie",
                    color: "#9C27B0",
                    size: 28,
                    title: "Concept: Circulaire Economie",
                },
                {
                    id: 11,
                    label: "Groene\nEnergie",
                    color: "#9C27B0",
                    size: 26,
                    title: "Concept: Groene Energie",
                },
                {
                    id: 12,
                    label: "Duurzaamheid",
                    color: "#9C27B0",
                    size: 30,
                    title: "Concept: Duurzaamheid",
                },
                {
                    id: 13,
                    label: "Smart\nMobility",
                    color: "#9C27B0",
                    size: 20,
                    title: "Concept: Smart Mobility",
                },

                {
                    id: 20,
                    label: "Flevoland",
                    color: "#FF9800",
                    size: 32,
                    title: "Locatie: Provincie Flevoland",
                },
                {
                    id: 21,
                    label: "Flevopolder\nZuid",
                    color: "#FF9800",
                    size: 18,
                    title: "Locatie: Flevopolder Zuid",
                },

                {
                    id: 30,
                    label: "Omgevingswet",
                    color: "#F44336",
                    size: 24,
                    title: "Wet: Omgevingswet",
                },
                {
                    id: 31,
                    label: "Woo",
                    color: "#F44336",
                    size: 26,
                    title: "Wet: Wet open overheid",
                },
                {
                    id: 32,
                    label: "Klimaatwet",
                    color: "#F44336",
                    size: 22,
                    title: "Wet: Klimaatwet",
                },

                {
                    id: 40,
                    label: "Maria Jansen",
                    color: "#7CB342",
                    size: 20,
                    title: "Persoon: Maria Jansen (Beleidsmedewerker)",
                },
                {
                    id: 41,
                    label: "Peter v/d Berg",
                    color: "#7CB342",
                    size: 18,
                    title: "Persoon: Peter van den Berg (Projectleider)",
                },
            ];

            const edgesData = [
                {
                    from: 1,
                    to: 20,
                    label: "LOCATED_IN",
                    title: "Provincie Flevoland is gelegen in Flevoland",
                },
                {
                    from: 2,
                    to: 20,
                    label: "LOCATED_IN",
                    title: "Gemeente Almere is gelegen in Flevoland",
                },
                {
                    from: 3,
                    to: 20,
                    label: "LOCATED_IN",
                    title: "Gemeente Lelystad is gelegen in Flevoland",
                },
                {
                    from: 4,
                    to: 20,
                    label: "LOCATED_IN",
                    title: "Waterschap is gelegen in Flevoland",
                },

                {
                    from: 1,
                    to: 10,
                    label: "MANAGES",
                    title: "Provincie beheert Circulaire Economie projecten",
                },
                {
                    from: 1,
                    to: 11,
                    label: "PROMOTES",
                    title: "Provincie bevordert Groene Energie",
                },
                {
                    from: 1,
                    to: 12,
                    label: "PRIORITIZES",
                    title: "Provincie prioriteert Duurzaamheid",
                },
                {
                    from: 2,
                    to: 10,
                    label: "IMPLEMENTS",
                    title: "Almere implementeert Circulaire Economie",
                },
                {
                    from: 2,
                    to: 13,
                    label: "DEVELOPS",
                    title: "Almere ontwikkelt Smart Mobility",
                },

                {
                    from: 10,
                    to: 12,
                    label: "PART_OF",
                    title: "Circulaire Economie is onderdeel van Duurzaamheid",
                },
                {
                    from: 11,
                    to: 12,
                    label: "PART_OF",
                    title: "Groene Energie is onderdeel van Duurzaamheid",
                },
                {
                    from: 10,
                    to: 11,
                    label: "RELATED_TO",
                    title: "Circulaire Economie en Groene Energie zijn gerelateerd",
                },

                {
                    from: 1,
                    to: 30,
                    label: "SUBJECT_TO",
                    title: "Provincie is onderworpen aan Omgevingswet",
                },
                {
                    from: 1,
                    to: 31,
                    label: "COMPLIES_WITH",
                    title: "Provincie voldoet aan Woo",
                },
                {
                    from: 10,
                    to: 32,
                    label: "SUPPORTS",
                    title: "Circulaire Economie ondersteunt Klimaatwet",
                },
                {
                    from: 11,
                    to: 32,
                    label: "SUPPORTS",
                    title: "Groene Energie ondersteunt Klimaatwet",
                },

                {
                    from: 21,
                    to: 20,
                    label: "PART_OF",
                    title: "Flevopolder Zuid is onderdeel van Flevoland",
                },
                {
                    from: 11,
                    to: 21,
                    label: "LOCATED_IN",
                    title: "Groene Energie projecten in Flevopolder Zuid",
                },

                {
                    from: 40,
                    to: 1,
                    label: "WORKS_FOR",
                    title: "Maria Jansen werkt voor Provincie Flevoland",
                },
                {
                    from: 40,
                    to: 10,
                    label: "MANAGES",
                    title: "Maria Jansen beheert Circulaire Economie",
                },
                {
                    from: 41,
                    to: 1,
                    label: "WORKS_FOR",
                    title: "Peter van den Berg werkt voor Provincie",
                },
                {
                    from: 41,
                    to: 13,
                    label: "LEADS",
                    title: "Peter leidt Smart Mobility project",
                },

                {
                    from: 1,
                    to: 2,
                    label: "COLLABORATES",
                    title: "Provincie en Almere werken samen",
                },
                {
                    from: 1,
                    to: 5,
                    label: "PARTNERS_WITH",
                    title: "Provincie partnert met Ministerie I&W",
                },
                {
                    from: 2,
                    to: 5,
                    label: "COORDINATES",
                    title: "Almere co√∂rdineert met Ministerie",
                },
            ];

            function initNetwork() {
                try {
                    console.log(
                        "Initializing network with",
                        nodesData.length,
                        "nodes and",
                        edgesData.length,
                        "edges",
                    );

                    const container = document.getElementById("mynetwork");

                    if (!container) {
                        throw new Error("Container element not found!");
                    }

                    // Create DataSets
                    const nodes = new vis.DataSet(
                        nodesData.map((node) => ({
                            id: node.id,
                            label: node.label,
                            color: {
                                background: node.color,
                                border: "#333",
                                highlight: {
                                    background: node.color,
                                    border: "#000",
                                },
                            },
                            font: {
                                color: "white",
                                size: 14,
                                face: "Arial",
                                bold: true,
                            },
                            size: node.size,
                            title: node.title,
                            borderWidth: 2,
                            shadow: true,
                        })),
                    );

                    const edges = new vis.DataSet(
                        edgesData.map((edge) => ({
                            from: edge.from,
                            to: edge.to,
                            label: edge.label,
                            title: edge.title,
                            arrows: "to",
                            color: {
                                color: "#666",
                                highlight: "#0066CC",
                            },
                            font: {
                                size: 11,
                                align: "top",
                            },
                            width: 2,
                            smooth: {
                                type: "cubicBezier",
                                roundness: 0.3,
                            },
                        })),
                    );

                    const data = { nodes: nodes, edges: edges };

                    const options = {
                        physics: {
                            enabled: true,
                            barnesHut: {
                                gravitationalConstant: -3000,
                                centralGravity: 0.3,
                                springLength: 150,
                                springConstant: 0.04,
                                damping: 0.09,
                                avoidOverlap: 0.5,
                            },
                            stabilization: {
                                iterations: 200,
                                updateInterval: 25,
                            },
                        },
                        interaction: {
                            hover: true,
                            tooltipDelay: 200,
                            navigationButtons: true,
                            keyboard: true,
                        },
                    };

                    network = new vis.Network(container, data, options);

                    // Event handlers
                    network.on("click", function (params) {
                        if (params.nodes.length > 0) {
                            const nodeId = params.nodes[0];
                            const node = nodesData.find((n) => n.id === nodeId);
                            if (node) {
                                alert(
                                    "Entiteit: " +
                                        node.label.replace(/\n/g, " ") +
                                        "\n" +
                                        node.title,
                                );
                            }
                        }
                    });

                    network.on("stabilizationIterationsDone", function () {
                        console.log("Network stabilized");
                        network.setOptions({ physics: false });
                        physicsEnabled = false;
                        document.getElementById("loading").style.display =
                            "none";
                    });

                    network.on("stabilizationProgress", function (params) {
                        const progress = Math.round(
                            (params.iterations / params.total) * 100,
                        );
                        document.getElementById("loading").innerHTML =
                            "<p>‚è≥ Laden van kennisgraaf... " +
                            progress +
                            "%</p>";
                    });

                    console.log("Network created successfully!");
                } catch (error) {
                    console.error("Error initializing network:", error);
                    document.getElementById("error-message").textContent =
                        "Fout bij laden van graaf: " + error.message;
                    document.getElementById("error-message").style.display =
                        "block";
                    document.getElementById("loading").style.display = "none";
                }
            }

            function fitNetwork() {
                if (network) {
                    network.fit({
                        animation: {
                            duration: 1000,
                            easingFunction: "easeInOutQuad",
                        },
                    });
                }
            }

            function togglePhysics() {
                if (network) {
                    physicsEnabled = !physicsEnabled;
                    network.setOptions({ physics: physicsEnabled });
                    alert(
                        physicsEnabled
                            ? "Physics ingeschakeld"
                            : "Physics uitgeschakeld",
                    );
                }
            }

            // Initialize when DOM is ready
            if (document.readyState === "loading") {
                document.addEventListener("DOMContentLoaded", function () {
                    console.log("DOM loaded, initializing...");
                    setTimeout(initNetwork, 100);
                });
            } else {
                console.log("DOM already loaded, initializing...");
                setTimeout(initNetwork, 100);
            }
        </script>
    </body>
</html>

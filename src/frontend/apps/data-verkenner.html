<!doctype html>
<html lang="nl">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Data Verkenner - Provincie Flevoland</title>
        <link rel="stylesheet" href="../flevoland-theme.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: #f5f7fa;
            }

            .header {
                background: linear-gradient(135deg, #0066CC 0%, #7CB342 100%);
                color: white;
                padding: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .header h1 {
                font-size: 24px;
            }

            .back-btn {
                background: rgba(255, 255, 255, 0.2);
                color: white;
                padding: 10px 20px;
                border-radius: 6px;
                text-decoration: none;
                transition: background 0.2s;
            }

            .back-btn:hover {
                background: rgba(255, 255, 255, 0.3);
            }

            .container {
                max-width: 1400px;
                margin: 20px auto;
                padding: 0 20px;
            }

            .context-info {
                background: white;
                padding: 15px 20px;
                border-radius: 8px;
                margin-bottom: 20px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            }

            .context-info strong {
                color: #0066CC;
            }

            .grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                margin-bottom: 20px;
            }

            .panel {
                background: white;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            }

            .panel h2 {
                font-size: 18px;
                margin-bottom: 15px;
                color: #333;
            }

            .chart-container {
                position: relative;
                height: 300px;
            }

            .data-table {
                width: 100%;
                border-collapse: collapse;
            }

            .data-table th {
                background: #f8f9fa;
                padding: 12px;
                text-align: left;
                font-weight: 600;
                border-bottom: 2px solid #dee2e6;
            }

            .data-table td {
                padding: 12px;
                border-bottom: 1px solid #dee2e6;
            }

            .data-table tr:hover {
                background: #f8f9fa;
            }

            .metric-card {
                background: linear-gradient(135deg, #0066CC 0%, #7CB342 100%);
                color: white;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 10px;
            }

            .metric-value {
                font-size: 36px;
                font-weight: bold;
                margin: 10px 0;
            }

            .metric-label {
                font-size: 14px;
                opacity: 0.9;
            }

            .filter-bar {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
            }

            .filter-bar select,
            .filter-bar input {
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 6px;
                flex: 1;
            }

            .btn {
                background: #0066CC;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                transition: background 0.2s;
            }

            .btn:hover {
                background: #5568d3;
            }

            .geo-map {
                width: 100%;
                height: 400px;
                background: #e9ecef;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #6c757d;
                font-size: 14px;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>üìä Data Verkenner</h1>
            <a href="../context_dashboard.html" class="back-btn"
                >‚Üê Terug naar Dashboard</a
            >
        </div>

        <div class="container">
            <div class="context-info">
                Context:
                <strong>Project: Circulaire Economie Flevoland 2025</strong> |
                Gebruiker: <strong>Sophie de Vries</strong> (Data Analist)
            </div>

            <div class="filter-bar">
                <select id="datasetSelect">
                    <option>Afvalstromen 2024</option>
                    <option>CO2 Reductie Monitoring</option>
                    <option>Subsidie Impact Analyse</option>
                    <option>Verkeerscijfers Flevoland</option>
                </select>
                <input type="date" value="2024-01-01" />
                <input type="date" value="2024-12-31" />
                <button class="btn">Filter toepassen</button>
            </div>

            <!-- Metrics Row -->
            <div class="grid">
                <div class="metric-card">
                    <div class="metric-label">Totaal Afval Gereduceerd</div>
                    <div class="metric-value">12.450 ton</div>
                    <div class="metric-label">‚Üó +18% t.o.v. vorig jaar</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Circulaire Projecten</div>
                    <div class="metric-value">47</div>
                    <div class="metric-label">Actief in Flevoland</div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid">
                <div class="panel">
                    <h2>Afvalstromen per Type (2024)</h2>
                    <div class="chart-container">
                        <canvas id="wasteChart"></canvas>
                    </div>
                </div>
                <div class="panel">
                    <h2>CO2 Reductie Trend</h2>
                    <div class="chart-container">
                        <canvas id="co2Chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Data Table -->
            <div class="panel">
                <h2>Afvalstromen Detail per Gemeente</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Gemeente</th>
                            <th>Totaal Afval (ton)</th>
                            <th>Gescheiden (ton)</th>
                            <th>Restafval (ton)</th>
                            <th>Percentage Gescheiden</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Almere</td>
                            <td>45.230</td>
                            <td>28.450</td>
                            <td>16.780</td>
                            <td>62.9%</td>
                            <td style="color: green">‚Üó +5.2%</td>
                        </tr>
                        <tr>
                            <td>Lelystad</td>
                            <td>22.150</td>
                            <td>13.890</td>
                            <td>8.260</td>
                            <td>62.7%</td>
                            <td style="color: green">‚Üó +3.8%</td>
                        </tr>
                        <tr>
                            <td>Dronten</td>
                            <td>15.680</td>
                            <td>9.340</td>
                            <td>6.340</td>
                            <td>59.6%</td>
                            <td style="color: green">‚Üó +2.1%</td>
                        </tr>
                        <tr>
                            <td>Urk</td>
                            <td>8.920</td>
                            <td>4.560</td>
                            <td>4.360</td>
                            <td>51.1%</td>
                            <td style="color: orange">‚Üó +0.8%</td>
                        </tr>
                        <tr>
                            <td>Noordoostpolder</td>
                            <td>18.540</td>
                            <td>11.220</td>
                            <td>7.320</td>
                            <td>60.5%</td>
                            <td style="color: green">‚Üó +4.2%</td>
                        </tr>
                        <tr>
                            <td>Zeewolde</td>
                            <td>9.890</td>
                            <td>6.120</td>
                            <td>3.770</td>
                            <td>61.9%</td>
                            <td style="color: green">‚Üó +3.5%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Geographic View -->
            <div class="panel">
                <h2>Geografische Weergave - Flevoland</h2>
                <div
                    id="map"
                    class="geo-map"
                    style="height: 400px; border-radius: 8px; overflow: hidden"
                ></div>
                <div style="margin-top: 10px; font-size: 12px; color: #666">
                    üìç Interactieve kaart met afvalstromen per gemeente in
                    Flevoland
                </div>
            </div>

            <!-- Export Options -->
            <div class="panel">
                <h2>Exporteer Data</h2>
                <div style="display: flex; gap: 10px">
                    <button
                        class="btn"
                        onclick="alert('Exporteren naar CSV...')"
                    >
                        üìÑ Export CSV
                    </button>
                    <button
                        class="btn"
                        onclick="alert('Exporteren naar Excel...')"
                    >
                        üìä Export Excel
                    </button>
                    <button
                        class="btn"
                        onclick="alert('Exporteren naar PDF rapport...')"
                    >
                        üìë Export PDF
                    </button>
                    <button
                        class="btn"
                        onclick="alert('Opslaan in project documenten...')"
                    >
                        üíæ Opslaan in Project
                    </button>
                </div>
            </div>
        </div>

        <script>
            // Waste Chart
            const wasteCtx = document
                .getElementById("wasteChart")
                .getContext("2d");
            new Chart(wasteCtx, {
                type: "doughnut",
                data: {
                    labels: [
                        "GFT Afval",
                        "Papier/Karton",
                        "Plastic",
                        "Glas",
                        "Restafval",
                    ],
                    datasets: [
                        {
                            data: [28450, 15230, 12890, 8950, 16780],
                            backgroundColor: [
                                "#4caf50",
                                "#2196f3",
                                "#ff9800",
                                "#9c27b0",
                                "#f44336",
                            ],
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: "bottom",
                        },
                    },
                },
            });

            // CO2 Chart
            const co2Ctx = document.getElementById("co2Chart").getContext("2d");
            new Chart(co2Ctx, {
                type: "line",
                data: {
                    labels: [
                        "Jan",
                        "Feb",
                        "Mrt",
                        "Apr",
                        "Mei",
                        "Jun",
                        "Jul",
                        "Aug",
                        "Sep",
                        "Okt",
                        "Nov",
                        "Dec",
                    ],
                    datasets: [
                        {
                            label: "CO2 Reductie (ton)",
                            data: [
                                850, 920, 1050, 1180, 1250, 1320, 1450, 1380,
                                1520, 1650, 1720, 1850,
                            ],
                            borderColor: "#0066CC",
                            backgroundColor: "rgba(102, 126, 234, 0.1)",
                            tension: 0.4,
                            fill: true,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                        },
                    },
                },
            });

            // Auto-refresh indicator
            let refreshCount = 0;
            setInterval(() => {
                refreshCount++;
                console.log(`Data refreshed ${refreshCount} times`);
            }, 30000);

            // Initialize Leaflet Map for Flevoland
            const map = L.map("map").setView([52.5188, 5.5408], 9.5);

            // Add OpenStreetMap tiles
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                attribution:
                    '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19,
                minZoom: 8,
            }).addTo(map);

            // Add scale control
            L.control
                .scale({
                    metric: true,
                    imperial: false,
                    position: "bottomleft",
                })
                .addTo(map);

            // Gemeenten in Flevoland met afvaldata
            const municipalities = [
                {
                    name: "Almere",
                    lat: 52.3508,
                    lng: 5.2647,
                    gft: 8500,
                    papier: 4200,
                    plastic: 3800,
                    totaal: 28450,
                    color: "#4caf50",
                },
                {
                    name: "Lelystad",
                    lat: 52.5085,
                    lng: 5.475,
                    gft: 6200,
                    papier: 3100,
                    plastic: 2900,
                    totaal: 21300,
                    color: "#2196f3",
                },
                {
                    name: "Dronten",
                    lat: 52.525,
                    lng: 5.7167,
                    gft: 4100,
                    papier: 2400,
                    plastic: 2100,
                    totaal: 15230,
                    color: "#ff9800",
                },
                {
                    name: "Urk",
                    lat: 52.663,
                    lng: 5.601,
                    gft: 2800,
                    papier: 1500,
                    plastic: 1300,
                    totaal: 8950,
                    color: "#9c27b0",
                },
                {
                    name: "Zeewolde",
                    lat: 52.3308,
                    lng: 5.5408,
                    gft: 3200,
                    papier: 1900,
                    plastic: 1600,
                    totaal: 12890,
                    color: "#f44336",
                },
                {
                    name: "Noordoostpolder",
                    lat: 52.7167,
                    lng: 5.75,
                    gft: 3650,
                    papier: 2130,
                    plastic: 2090,
                    totaal: 13960,
                    color: "#00bcd4",
                },
            ];

            // Add markers for each municipality
            municipalities.forEach((mun) => {
                // Calculate proportional radius (square root for better visual scaling)
                // Base radius on total waste, scaled appropriately for map
                const baseRadius = 2000; // Base radius in meters
                const scaleFactor = Math.sqrt(mun.totaal / 15000); // Normalize to average
                const radius = baseRadius * scaleFactor;

                const circle = L.circle([mun.lat, mun.lng], {
                    color: mun.color,
                    fillColor: mun.color,
                    fillOpacity: 0.5,
                    weight: 2,
                    radius: radius, // Radius in meters, properly scaled
                }).addTo(map);

                // Create popup content
                const popupContent = `
                    <div style="font-family: 'Segoe UI', sans-serif;">
                        <h3 style="margin: 0 0 10px 0; color: #333;">${mun.name}</h3>
                        <table style="font-size: 13px; width: 100%;">
                            <tr>
                                <td style="padding: 3px 10px 3px 0;"><strong>üå± GFT Afval:</strong></td>
                                <td style="padding: 3px 0;">${mun.gft.toLocaleString()} ton</td>
                            </tr>
                            <tr>
                                <td style="padding: 3px 10px 3px 0;"><strong>üìÑ Papier:</strong></td>
                                <td style="padding: 3px 0;">${mun.papier.toLocaleString()} ton</td>
                            </tr>
                            <tr>
                                <td style="padding: 3px 10px 3px 0;"><strong>‚ôªÔ∏è Plastic:</strong></td>
                                <td style="padding: 3px 0;">${mun.plastic.toLocaleString()} ton</td>
                            </tr>
                            <tr style="border-top: 1px solid #ddd;">
                                <td style="padding: 8px 10px 3px 0;"><strong>üìä Totaal:</strong></td>
                                <td style="padding: 8px 0 3px 0;"><strong>${mun.totaal.toLocaleString()} ton</strong></td>
                            </tr>
                        </table>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; font-size: 11px; color: #666;">
                            Project: Circulaire Economie Flevoland 2025
                        </div>
                    </div>
                `;

                circle.bindPopup(popupContent);

                // Also add a marker with label
                const marker = L.marker([mun.lat, mun.lng]).addTo(map);
                marker.bindPopup(popupContent);
                marker.bindTooltip(mun.name, {
                    permanent: false,
                    direction: "top",
                });
            });

            // Add a legend
            const legend = L.control({ position: "bottomright" });
            legend.onAdd = function (map) {
                const div = L.DomUtil.create("div", "info legend");
                div.style.background = "white";
                div.style.padding = "10px";
                div.style.borderRadius = "8px";
                div.style.boxShadow = "0 2px 8px rgba(0,0,0,0.2)";
                div.innerHTML = `
                    <h4 style="margin: 0 0 8px 0; font-size: 14px;">Gemeenten Flevoland</h4>
                    <div style="font-size: 12px;">
                        <div style="margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #ddd;">
                            <div><span style="color: #4caf50;">‚óè</span> Almere (28.450 ton)</div>
                            <div><span style="color: #2196f3;">‚óè</span> Lelystad (21.300 ton)</div>
                            <div><span style="color: #ff9800;">‚óè</span> Dronten (15.230 ton)</div>
                            <div><span style="color: #00bcd4;">‚óè</span> N.O.Polder (13.960 ton)</div>
                            <div><span style="color: #f44336;">‚óè</span> Zeewolde (12.890 ton)</div>
                            <div><span style="color: #9c27b0;">‚óè</span> Urk (8.950 ton)</div>
                        </div>
                        <div style="font-size: 11px; color: #666;">
                            Cirkelgrootte = totaal afval
                        </div>
                    </div>
                `;
                return div;
            };
            legend.addTo(map);
        </script>
    </body>
</html>
